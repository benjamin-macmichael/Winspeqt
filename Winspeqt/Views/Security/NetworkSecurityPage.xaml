<Page
    x:Class="Winspeqt.Views.Security.NetworkSecurityPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Winspeqt.Views.Security"
    xmlns:helpers="using:Winspeqt.Helpers"
    xmlns:viewmodels="using:Winspeqt.ViewModels.Security"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>

        <Style x:Key="RiskHighStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#D13438"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="RiskMediumStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#F7630C"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="RiskLowStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Grid Grid.Row="0" Margin="24,24,24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="Network Security Monitor" 
                           Style="{StaticResource TitleTextBlockStyle}"
                           Margin="0,0,0,4"/>
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button Content="Start Monitoring" 
                        Command="{x:Bind ViewModel.StartMonitoringCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.IsMonitoring, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F5"/>
                    </Button.KeyboardAccelerators>
                </Button>
                
                <Button Content="Stop Monitoring" 
                        Command="{x:Bind ViewModel.StopMonitoringCommand}"
                        Visibility="{x:Bind ViewModel.IsMonitoring, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                
                <Button Command="{x:Bind ViewModel.RefreshCommand}"
                        ToolTipService.ToolTip="Refresh">
                    <FontIcon Glyph="&#xE72C;"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Stats Cards -->
        <ScrollViewer Grid.Row="1" 
                      HorizontalScrollMode="Auto" 
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollMode="Disabled"
                      Margin="24,0,24,16">
            <StackPanel Orientation="Horizontal">
                <Border Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Active Connections" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.TotalConnections, Mode=OneWay}" 
                                   Style="{StaticResource TitleLargeTextBlockStyle}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Listening Ports" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.ListeningPorts, Mode=OneWay}" 
                                   Style="{StaticResource TitleLargeTextBlockStyle}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Risky Connections" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.RiskyConnections, Mode=OneWay}" 
                                   Style="{StaticResource TitleLargeTextBlockStyle}"
                                   Foreground="#D13438"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Data Sent" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.TotalTrafficSent, Mode=OneWay}" 
                                   Style="{StaticResource TitleLargeTextBlockStyle}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource StatCardStyle}" Margin="0">
                    <StackPanel>
                        <TextBlock Text="Data Received" 
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind ViewModel.TotalTrafficReceived, Mode=OneWay}" 
                                   Style="{StaticResource TitleLargeTextBlockStyle}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Tabs for different views -->
        <TabView Grid.Row="2" Margin="24,0,24,24">
            <!-- Active Connections Tab -->
            <TabViewItem Header="Active Connections">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="Link"/>
                </TabViewItem.IconSource>
                <Grid>
                    <ListView ItemsSource="{x:Bind ViewModel.ActiveConnections, Mode=OneWay}"
                              SelectionMode="Single">
                        <ListView.Header>
                            <Grid Padding="12,8" 
                                  Background="{ThemeResource LayerFillColorDefaultBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Protocol" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="Local Endpoint" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="2" Text="Remote Endpoint" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="3" Text="State" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="4" Text="Risk Level" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="5" Text="Security Risk" FontWeight="SemiBold"/>
                            </Grid>
                        </ListView.Header>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Protocol}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayLocalEndpoint}" FontFamily="Consolas"/>
                                    <TextBlock Grid.Column="2" Text="{Binding DisplayRemoteEndpoint}" FontFamily="Consolas"/>
                                    <TextBlock Grid.Column="3" Text="{Binding State}"/>
                                    <TextBlock Grid.Column="4" Text="{Binding RiskLevel}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Setters>
                                                    <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Style.Setters>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Grid.Column="5" 
                                               Text="{Binding SecurityRisk}" 
                                               TextWrapping="Wrap"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </TabViewItem>

            <!-- Open Ports Tab -->
            <TabViewItem Header="Open Ports">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="RepeatAll"/>
                </TabViewItem.IconSource>
                <Grid>
                    <ListView ItemsSource="{x:Bind ViewModel.OpenPorts, Mode=OneWay}"
                              SelectionMode="Single">
                        <ListView.Header>
                            <Grid Padding="12,8" 
                                  Background="{ThemeResource LayerFillColorDefaultBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Port" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="Protocol" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="2" Text="State" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="3" Text="Service" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="4" Text="Risk Description" FontWeight="SemiBold"/>
                            </Grid>
                        </ListView.Header>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Port}" FontFamily="Consolas" FontWeight="SemiBold"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Protocol}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding State}"/>
                                    <TextBlock Grid.Column="3" Text="{Binding ServiceName}"/>
                                    <TextBlock Grid.Column="4" 
                                               Text="{Binding RiskDescription}" 
                                               TextWrapping="Wrap">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Setters>
                                                    <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Style.Setters>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </TabViewItem>

            <!-- Network Traffic Tab -->
            <TabViewItem Header="Network Traffic">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="MapDrive"/>
                </TabViewItem.IconSource>
                <Grid>
                    <ListView ItemsSource="{x:Bind ViewModel.TrafficStats, Mode=OneWay}"
                              SelectionMode="Single">
                        <ListView.Header>
                            <Grid Padding="12,8" 
                                  Background="{ThemeResource LayerFillColorDefaultBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="250"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="150"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Interface" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="Data Sent" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="2" Text="Data Received" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="3" Text="Send Rate" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="4" Text="Receive Rate" FontWeight="SemiBold"/>
                            </Grid>
                        </ListView.Header>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="250"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="150"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding InterfaceName}" FontWeight="SemiBold"/>
                                    <TextBlock Grid.Column="1" Text="{Binding FormattedBytesSent}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding FormattedBytesReceived}"/>
                                    <TextBlock Grid.Column="3" Text="{Binding FormattedSendRate}"/>
                                    <TextBlock Grid.Column="4" Text="{Binding FormattedReceiveRate}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </TabViewItem>

            <!-- Security Alerts Tab -->
            <TabViewItem Header="Security Alerts">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="Important"/>
                </TabViewItem.IconSource>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <CommandBar Grid.Row="0" DefaultLabelPosition="Right">
                        <AppBarButton Icon="Delete" 
                                      Label="Clear Alerts" 
                                      Command="{x:Bind ViewModel.ClearAlertsCommand}"/>
                    </CommandBar>

                    <ListView Grid.Row="1" 
                              ItemsSource="{x:Bind ViewModel.SecurityAlerts, Mode=OneWay}"
                              SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Grid Padding="12,8">
                                    <TextBlock Text="{x:Bind}" 
                                               TextWrapping="Wrap"
                                               FontFamily="Consolas"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </TabViewItem>
        </TabView>
    </Grid>
</Page>
