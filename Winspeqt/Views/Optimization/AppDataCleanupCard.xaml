<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Winspeqt.Views.Optimization.AppDataCleanupCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Winspeqt.Models"
    mc:Ignorable="d">

	<Page.Resources>

		<!-- Card surface -->
		<Style x:Key="CardStyle" TargetType="Border">
			<Setter Property="Background"       Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
			<Setter Property="BorderBrush"      Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
			<Setter Property="BorderThickness"  Value="1"/>
			<Setter Property="CornerRadius"     Value="8"/>
			<Setter Property="Padding"          Value="24"/>
		</Style>

		<!-- Row item template -->
		<DataTemplate x:Key="OrphanRowTemplate" x:DataType="models:OrphanedAppDataEntry">
			<Grid Padding="0,8" ColumnSpacing="12">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="72"/>
					<ColumnDefinition Width="72"/>
				</Grid.ColumnDefinitions>

				<!-- Checkbox -->
				<CheckBox Grid.Column="0"
                          IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          MinWidth="0"/>

				<!-- Folder name + path -->
				<StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
					<TextBlock Text="{x:Bind FolderName}"
                               Style="{ThemeResource BodyStrongTextBlockStyle}"
                               TextTrimming="CharacterEllipsis"/>
					<TextBlock Text="{x:Bind FolderPath}"
                               Style="{ThemeResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextTrimming="CharacterEllipsis"/>
				</StackPanel>

				<!-- Location badge -->
				<Border Grid.Column="2"
                        Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                        CornerRadius="4"
                        Padding="6,2"
                        VerticalAlignment="Center">
					<TextBlock Text="{x:Bind LocationLabel}"
                               Style="{ThemeResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
				</Border>

				<!-- Size -->
				<TextBlock Grid.Column="3"
                           Text="{x:Bind SizeDisplay}"
                           Style="{ThemeResource BodyTextBlockStyle}"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"/>

				<!-- Age -->
				<TextBlock Grid.Column="4"
                           Text="{x:Bind LastModifiedDisplay}"
                           Style="{ThemeResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"/>
			</Grid>
		</DataTemplate>

	</Page.Resources>

	<!-- ═══════════════════════════════════════════════════════════════════════
         Root layout
    ════════════════════════════════════════════════════════════════════════ -->
	<Border Style="{StaticResource CardStyle}">
		<Grid RowSpacing="20">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<!-- header -->
				<RowDefinition Height="Auto"/>
				<!-- scanning state -->
				<RowDefinition Height="*"/>
				<!-- results list -->
				<RowDefinition Height="Auto"/>
				<!-- footer actions -->
			</Grid.RowDefinitions>

			<!-- ── Header ──────────────────────────────────────────────── -->
			<Grid Grid.Row="0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<StackPanel Grid.Column="0" Spacing="4">
					<StackPanel Orientation="Horizontal" Spacing="10">
						<FontIcon Glyph="&#xE74D;"
                                  FontSize="20"
                                  Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
						<TextBlock Text="Safe AppData Cleanup"
                                   Style="{ThemeResource SubtitleTextBlockStyle}"/>
					</StackPanel>
					<TextBlock Text="Find and remove leftover folders from uninstalled applications."
                               Style="{ThemeResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
				</StackPanel>

				<!-- Scan button -->
				<Button x:Name="ScanButton"
                        Grid.Column="1"
                        Content="Scan Now"
                        Style="{ThemeResource AccentButtonStyle}"
                        VerticalAlignment="Center"
                        Click="ScanButton_Click"/>
			</Grid>

			<!-- ── Progress / Status strip ─────────────────────────────── -->
			<Grid Grid.Row="1" x:Name="StatusStrip">

				<!-- Scanning in progress -->
				<StackPanel x:Name="ScanningPanel"
                            Visibility="Collapsed"
                            Spacing="8">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<ProgressRing x:Name="ScanRing" IsActive="True" Width="18" Height="18"/>
						<TextBlock x:Name="ScanStatusText"
                                   Text="Scanning AppData folders…"
                                   Style="{ThemeResource BodyTextBlockStyle}"
                                   VerticalAlignment="Center"/>
					</StackPanel>
					<ProgressBar x:Name="ScanProgressBar" IsIndeterminate="True"/>
				</StackPanel>

				<!-- Deleting in progress -->
				<StackPanel x:Name="DeletingPanel"
                            Visibility="Collapsed"
                            Spacing="8">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<ProgressRing IsActive="True" Width="18" Height="18"/>
						<TextBlock x:Name="DeleteStatusText"
                                   Text="Deleting…"
                                   Style="{ThemeResource BodyTextBlockStyle}"
                                   VerticalAlignment="Center"/>
					</StackPanel>
					<ProgressBar x:Name="DeleteProgressBar" Value="0" Maximum="100"/>
				</StackPanel>

				<!-- Result summary -->
				<InfoBar x:Name="ResultInfoBar"
                         IsOpen="False"
                         IsClosable="True"/>
			</Grid>

			<!-- ── Results list ─────────────────────────────────────────── -->
			<Grid Grid.Row="2">

				<!-- Not yet scanned placeholder -->
				<StackPanel x:Name="PreScanState"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Padding="0,40">
					<FontIcon Glyph="&#xE838;"
                              FontSize="48"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              HorizontalAlignment="Center"/>
					<TextBlock Text="Run a scan to find orphaned AppData folders."
                               Style="{ThemeResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               HorizontalAlignment="Center"/>
				</StackPanel>

				<!-- Scan ran, nothing found -->
				<StackPanel x:Name="CleanState"
                            Visibility="Collapsed"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12"
                            Padding="0,40">
					<FontIcon Glyph="&#xE73E;"
                              FontSize="48"
                              Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                              HorizontalAlignment="Center"/>
					<TextBlock Text="No orphaned folders found. Your AppData looks clean!"
                               Style="{ThemeResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               HorizontalAlignment="Center"/>
				</StackPanel>

				<!-- Results -->
				<Grid x:Name="ResultsPanel" Visibility="Collapsed" RowSpacing="8">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<!-- Column headers + select-all -->
					<Grid Grid.Row="0" Padding="0,0,0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="72"/>
							<ColumnDefinition Width="72"/>
						</Grid.ColumnDefinitions>

						<CheckBox x:Name="SelectAllCheckBox"
                                  Grid.Column="0"
                                  MinWidth="0"
                                  Click="SelectAllCheckBox_Click"
                                  ToolTipService.ToolTip="Select / deselect all"/>

						<TextBlock Grid.Column="1"
                                   Text="Folder"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   VerticalAlignment="Center"/>

						<TextBlock Grid.Column="2"
                                   Text="Location"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   VerticalAlignment="Center"/>

						<TextBlock Grid.Column="3"
                                   Text="Size"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"/>

						<TextBlock Grid.Column="4"
                                   Text="Last Used"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"/>
					</Grid>

					<!-- Scrollable item list -->
					<ScrollViewer Grid.Row="1" MaxHeight="400">
						<ItemsRepeater x:Name="OrphanList"
                                       ItemTemplate="{StaticResource OrphanRowTemplate}">
							<ItemsRepeater.Layout>
								<StackLayout Spacing="0"/>
							</ItemsRepeater.Layout>
						</ItemsRepeater>
					</ScrollViewer>
				</Grid>
			</Grid>

			<!-- ── Footer actions ──────────────────────────────────────── -->
			<Grid Grid.Row="3" x:Name="FooterBar" Visibility="Collapsed">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<!-- Summary of selection -->
				<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
					<TextBlock x:Name="SelectionSummaryText"
                               Style="{ThemeResource BodyTextBlockStyle}"
                               VerticalAlignment="Center"/>
					<TextBlock x:Name="SpaceReclaimText"
                               Style="{ThemeResource BodyStrongTextBlockStyle}"
                               Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                               VerticalAlignment="Center"/>
				</StackPanel>

				<!-- Delete selected -->
				<Button x:Name="DeleteButton"
                        Grid.Column="1"
                        Content="Delete Selected"
                        IsEnabled="False"
                        Click="DeleteButton_Click">
					<Button.Style>
						<Style TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
							<Setter Property="Background" Value="{ThemeResource SystemFillColorCriticalBrush}"/>
							<Setter Property="Foreground" Value="White"/>
						</Style>
					</Button.Style>
				</Button>
			</Grid>

		</Grid>
	</Border>
</Page>
