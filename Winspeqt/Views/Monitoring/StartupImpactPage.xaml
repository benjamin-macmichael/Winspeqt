<Page
    x:Class="Winspeqt.Views.Monitoring.StartupImpactPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:Winspeqt.Helpers" xmlns:monitoring="using:Winspeqt.ViewModels.Monitoring" d:DataContext="{d:DesignInstance Type=monitoring:StartupImpactViewModel}"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <Style x:Key="StartupExampleCardBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="MinHeight" Value="140"/>
        </Style>
        <Style x:Key="StartupExampleTextStyle" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="WrapWholeWords"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,12,0,0"/>
        </Style>
    </Page.Resources>

    <ScrollViewer>
        <Grid Padding="60">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button 
                    Grid.Column="0"
                    Content="â† Back"
                    Click="BackButton_Click"
                    Background="Transparent"
                    BorderThickness="0"
                    FontSize="16"
                    Margin="0,0,20,0"/>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock 
                        Text="Startup Applications" 
                        FontSize="36" 
                        FontWeight="Bold"/>
                    <TextBlock 
                        Text="See which apps run on your PC's startup" 
                        FontSize="18" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Margin="0,4,0,0"/>
                </StackPanel>

                <Button 
                    Grid.Column="2"
                    Content="ðŸ”„ Refresh"
                    Command="{Binding RefreshCommand}"
                    FontSize="16"
                    Padding="16,8"/>
            </Grid>
            <!-- https://support.microsoft.com/en-us/windows/configure-startup-applications-in-windows-115a420a-0bff-4a6f-90e0-1934c844e473 -->
            <Border 
                Grid.Row="2"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="2"
                CornerRadius="16"
                Padding="10"
                Margin="0,0,0,32">
                <StackPanel>
                    <TextBlock
                        TextWrapping="WrapWholeWords"
                        Text="The applications that run automatically when your device boots up can impact both the speed of your startup and the overall performance of your system. By customizing which applications launch on startup, you can streamline your routine, ensuring that only the tools you need for your daily tasks are ready and waiting for you. Startup applications can be edited using the Windows Settings App or by editing the appropriate source."/>
                    <TextBlock
                        Text="Common Startup App Types"
                        FontSize="20"
                        FontWeight="SemiBold"
                        Margin="0,12,0,8"
                        HorizontalAlignment="Center"/>
                    <Grid HorizontalAlignment="Stretch" ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Style="{StaticResource StartupExampleCardBorderStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <Image Source="/Assets/StartupApps/teams.png" Height="72" Width="72" Stretch="Uniform" />
                                <TextBlock
                                    Style="{StaticResource StartupExampleTextStyle}"
                                    Text="Communications apps such as Microsoft Teams or Slack" />
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="1" Style="{StaticResource StartupExampleCardBorderStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <Image Source="/Assets/StartupApps/steam.png" Height="72" Width="72" Stretch="Uniform" />
                                <TextBlock
                                    Style="{StaticResource StartupExampleTextStyle}"
                                    Text="Media and game launchers such as Steam or Spotify" />
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2" Style="{StaticResource StartupExampleCardBorderStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <Image Source="/Assets/StartupApps/dropbox.png" Height="72" Width="72" Stretch="Uniform" />
                                <TextBlock
                                    Style="{StaticResource StartupExampleTextStyle}"
                                    Text="Cloud and sync clients such as Dropbox or OneDrive" />
                            </StackPanel>
                        </Border>
                    </Grid>
                    <Button 
                        Content="View Startup Settings"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Center"
                        Click="OpenStartupSettings_Click"/>
                </StackPanel>
            </Border>
            <Border Grid.Row="3" Margin="0,0,0,32">
                <Button Click="ShowAdvancedSettings_Click" Content="{x:Bind ViewModel.AdvancedSettingsText, Mode=OneWay}" HorizontalAlignment="Center"/>
            </Border>

            <StackPanel Grid.Row="4" Visibility="{x:Bind ViewModel.ShowAdvancedSettings, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <Border
                    BorderBrush="{ThemeResource SystemControlErrorTextForegroundBrush}"
                    Background="{ThemeResource SystemControlErrorBackgroundColor}"
                    BorderThickness="2"
                    CornerRadius="16"
                    Padding="10"
                    Margin="0,0,0,32"
                    MaxWidth="600">
                    <StackPanel Margin="5,5,5,5">
                        <StackPanel Orientation="Horizontal">
                            <FontIcon
                            Glyph="&#xE7BA;"
                            FontSize="20"
                            Foreground="{ThemeResource SystemControlErrorTextForegroundBrush}"/>
                            <TextBlock Text="WARNING:" FontSize="20" Foreground="{ThemeResource SystemControlErrorTextForegroundBrush}"/>
                        </StackPanel>
                        <TextBlock 
                        TextWrapping="WrapWholeWords"
                        Foreground="{ThemeResource SystemControlErrorTextForegroundBrush}"
                        Text="Modifying startup apps may result in unintended behavior. It is recommended that you change the startup status of an app in the Windows Settings App unless you are sure that it will not otherwise affect how your system runs." />
                    </StackPanel>
                </Border>
                <ItemsRepeater ItemsSource="{Binding StartupAppGroups, Mode=OneWay}">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <Expander Margin="0,0,0,12" HorizontalAlignment="Stretch" MaxHeight="500" HorizontalContentAlignment="Stretch">
                                <Expander.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            Text="{Binding Title}"
                                            FontSize="20"
                                            FontWeight="SemiBold"
                                            Margin="0,0,0,0"/>
                                        <Button Style="{StaticResource SubtleButtonStyle}" Margin="5,0,0,0">
                                            <FontIcon
                                                FontSize="18"
                                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                Glyph="&#xE946;" />
                                            <!--Content="i" CornerRadius="100" BorderBrush="Blue">-->
                                            <Button.Flyout>
                                                <Flyout>
                                                    <StackPanel MaxHeight="500">
                                                        <TextBlock
                                                            Text="{Binding Description}" 
                                                            Margin="0,0,0,12"
                                                            TextWrapping="Wrap"
                                                            MaxWidth="400"/>
                                                        <Button Click="LinkButton_Click" Content="{Binding ButtonText}" CommandParameter="{Binding Link}" />
                                                    </StackPanel>
                                                </Flyout>
                                            </Button.Flyout>
                                        </Button>
                                    </StackPanel>

                                </Expander.Header>
                                <Expander.Content>
                                    <ScrollView HorizontalAlignment="Stretch">
                                        <ItemsRepeater ItemsSource="{Binding Items, Mode=OneWay}" HorizontalAlignment="Stretch">
                                            <ItemsRepeater.ItemTemplate>
                                                <DataTemplate>
                                                    <Border
                                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="8"
                                                        Padding="20"
                                                        Margin="0,0,0,12"
                                                        HorizontalAlignment="Stretch">
                                                        <StackPanel>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock
                                                                    Text="Program:"
                                                                    FontSize="18"
                                                                    FontWeight="SemiBold"
                                                                    TextWrapping="Wrap"
                                                                    Padding="0, 0, 6, 0"/>
                                                                <TextBlock
                                                                    Text="{Binding Name}"
                                                                    FontSize="18"
                                                                    TextWrapping="Wrap"/>
                                                            </StackPanel>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock
                                                                    Text="Running command:"
                                                                    FontSize="16"
                                                                    FontWeight="SemiBold"
                                                                    TextWrapping="Wrap"
                                                                    Padding="0, 0, 6, 0"/>
                                                                <TextBlock
                                                                    Text="{Binding Command}"
                                                                    FontSize="16"
                                                                    TextWrapping="Wrap"/>
                                                            </StackPanel>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock
                                                                    Text="Source:"
                                                                    FontSize="16"
                                                                    FontWeight="SemiBold"
                                                                    TextWrapping="Wrap"
                                                                    Padding="0, 0, 6, 0"/>
                                                                <TextBlock
                                                                    Text="{Binding Location}"
                                                                    FontSize="16"/>
                                                            </StackPanel>


                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsRepeater.ItemTemplate>
                                        </ItemsRepeater>
                                    </ScrollView>

                                </Expander.Content>
                            </Expander>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
                <!-- Loading Overlay -->
                <Border
                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ProgressRing 
                        IsActive="True"
                        Width="20"
                        Height="20"/>
                </Border>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>
